"use strict";

module.exports = function(options, imports, register) {
    if ((!options.username || !options.password) && !options.adict)
        return register();

    var callback = function(user, pass) {
        if (!options.adict[user]) return false;
        return options.adict[user].password == pass;
    };
    
    var connect = imports.connect;
    if (!options.adict) {
        connect.useSetup(connect.getModule().basicAuth(options.username, options.password));
    } else {
        connect.useSetup(connect.getModule().basicAuth(callback, "Cloud9 Auth Realm"));
    }

    console.log("Using basic authentication");

    register();
};

